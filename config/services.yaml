# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    app_content_types: ['application/json', 'application/xml']
    app_valid_locales: ['de', 'en', 'es', 'fr', 'it', 'nl', 'pl', 'pt']
    app_classif_levels: ['regions', 'sub-regions']
    language_codes_url: '%env(string:LANGUAGES_CODES_URL)%'
    unsd_url: '%env(UNSD_URL)%'

    zones_parameters:
        - provider: restCountriesEu
          globalCode: 001
          regionName: region
          subRegionName: subregion
          countryName: name
          alpha2: alpha2code
          alpha3: alpha3code
        - provider: unM49
          globalCode: 001
          regionName: 3
          subRegionName: 5
          countryName: 8
          alpha2: 10
          alpha3: 11
services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.
        bind:
            $storageDir: '%kernel.project_dir%/src/Infrastructure/Storage/'
            $zonesParameters: '%zones_parameters%'
            $unsdUrl: '%unsd_url%'


    MyPrm\GeoZones\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Domain/Entity'
            - '../src/Infrastructure/Kernel.php'
            - '../src/Tests/'

    MyPrm\GeoZones\Infrastructure\Http\Controller\:
        resource: '../src/Infrastructure/Http/Controller/'
        tags: ['controller.service_arguments']

    MyPrm\GeoZones\Infrastructure\Exception\Listener\ExceptionListener:
        tags:
            - { name: kernel.event_listener, event: kernel.exception }


    MyPrm\GeoZones\Infrastructure\Http\Validator\GeoZonesRequestValidator:
        arguments:
            - '%app_content_types%'
            - '%app_valid_locales%'
            - '%app_classif_levels%'


    MyPrm\GeoZones\Domain\Builder\ZonesBuilder\:
        resource: '../src/Domain/Builder/ZonesBuilder/'
        tags:
            - { name: zone_builder }

    MyPrm\GeoZones\Domain\Builder\ZonesBuilderRegistry:
        class: MyPrm\GeoZones\Domain\Builder\ZonesBuilderRegistry
        arguments:
          - !tagged_iterator zone_builder




















